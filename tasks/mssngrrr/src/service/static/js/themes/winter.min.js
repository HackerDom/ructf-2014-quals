/*!
 * Snowing routine based on one <canvas> element dynamically 
 * injected in the background of the page.
 * 
 * The code is not optimized, feel free to make your own edits!
 *
 * Copyright 2010 by David Flanagan
 * http://creativecommons.org/licenses/by-nc-sa/3.0/
 *
 * Modified by Giorgio Sardo
 * http://blogs.msdn.com/Giorgio
 *
 * Modified by Konstantin Kichinskiy
 * http://habrahabr.ru/users/kichik/
 */
(function(){if(document.createElement("canvas").getContext){if(document.readyState==="complete"){a()}else{window.addEventListener("DOMContentLoaded",a,false)}}else{return}var b=Math.PI/180;var g=10;var l=[];var m=64;var p=500;var c,i;var f;var h=false;var e=["#6cf","#9cf","#99f","#ccf","#66f","#3cf"];function k(r){return Math.floor(r*Math.random())}function a(){c=document.createElement("canvas");c.style.position="fixed";c.style.top="0px";c.style.left="0px";c.style.zIndex="-10";document.body.insertBefore(c,document.body.firstChild);i=c.getContext("2d");q();f=setInterval(j,p);setInterval(n,m);window.addEventListener("resize",q,false)}function q(){h=true;c.width=document.body.offsetWidth;c.height=window.innerHeight}function o(s,r){i.save();if(s==0){i.lineTo(r,0)}else{i.scale(1/3,1/3);o(s-1,r);i.rotate(60*b);o(s-1,r);i.rotate(-120*b);o(s-1,r);i.rotate(60*b);o(s-1,r)}i.restore();i.translate(r,0)}function d(s,z,v,r,w,u,t){i.save();i.strokeStyle=u;i.fillStyle=t;i.beginPath();i.translate(s,z);i.moveTo(0,0);i.rotate(v);o(w,r);i.rotate(-120*b);o(w,r);i.rotate(-120*b);o(w,r);i.closePath();i.fill();i.stroke();i.restore()}function j(){var s=2+k(2);var t=10*s+k(10);var r=k(document.body.offsetWidth);var v=window.pageYOffset;var u=e[k(e.length)];l.push({x:r,y:v,vx:0,vy:3+k(3),angle:0,size:t,order:s,stroke:u,fill:"transparent"});if(l.length>g){clearInterval(f)}}function n(){i.clearRect(0,0,c.width,c.height);var t=c.height;for(var s=0;s<l.length;s++){var r=l[s];r.y+=r.vy;r.x+=r.vx;if(r.y>t){r.y=0}if(h){r.x=k(c.width)}d(r.x,r.y,r.angle,r.size,r.order,r.stroke,r.fill);if(k(4)==1){r.vx+=(k(11)-5)/10}if(r.vx>2){r.vx=2}if(r.vx<-2){r.vx=-2}if(k(3)==1){r.angle=(k(13)-6)/271}}if(h){h=false}}}());